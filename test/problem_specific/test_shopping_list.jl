
"""
Text from paper: 

Given a vector of ﬂoats representing
the prices of various shopping goods and another vector of
ﬂoats representing the percent discount of each of those
goods, return the total price of the shopping trip after ap-
plying the discount to each item.
"""

train_data = [
    [[[50.0], [100.0]], [0.0]],
    [[[50.0], [10.0]], [45.0]],
    [[[20.0, 20.0], [100.0, 50.0]], [10.0]],
    [[[20.0, 20.0], [20.0, 0.0]], [36.0]],
    [[[10.0, 20.0, 30.0], [5.0, 10.0, 95.0]], [29.0]],
    [[[43.14, 18.23, 5.33, 1.35, 39.68], [100.0, 100.0, 100.0, 100.0, 100.0]], [0.0]],
    [
        [
            [
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
                5.73,
            ],
            [
                59.19,
                91.24,
                25.93,
                16.18,
                24.65,
                61.96,
                67.91,
                43.87,
                36.23,
                34.3,
                96.27,
                69.25,
                73.78,
                0.52,
                8.91,
                39.18,
                79.67,
                64.22,
                14.15,
                52.44,
            ],
        ],
        [59.6],
    ],
    [[[25.43, 43.22, 23.42, 42.09, 25.7], [0.0, 0.0, 0.0, 0.0, 0.0]], [159.86]],
    [
        [
            [0.01, 0.01, 0.01, 0.01, 0.01, 0.01, 0.01],
            [85.77, 43.99, 22.78, 34.14, 34.12, 8.54, 11.03],
        ],
        [0.05],
    ],
    [
        [
            [9.99, 9.99, 9.99, 9.99, 9.99, 9.99, 9.99, 9.99, 9.99, 9.99],
            [33.65, 33.65, 33.65, 33.65, 33.65, 33.65, 33.65, 33.65, 33.65, 33.65],
        ],
        [66.28],
    ],
    [
        [
            [12.64, 14.76, 33.88, 16.08, 5.63, 12.23, 1.97, 38.49, 26.08, 37.63],
            [78.61, 85.36, 59.19, 47.53, 62.05, 28.21, 0.71, 19.17, 14.94, 10.91],
        ],
        [126.82],
    ],
    [
        [
            [49.51, 39.81, 38.66, 10.38, 28.09, 34.7, 32.08, 32.2],
            [85.33, 50.19, 54.13, 53.58, 9.15, 87.32, 96.29, 18.19],
        ],
        [107.1],
    ],
    [
        [
            [47.04, 2.54, 2.99, 2.32, 41.64, 46.39, 25.01, 28.01],
            [50.33, 1.13, 77.07, 22.68, 51.12, 3.11, 62.09, 81.27],
        ],
        [108.38],
    ],
    [
        [
            [
                14.05,
                7.19,
                5.61,
                38.45,
                18.8,
                31.16,
                34.17,
                48.13,
                5.26,
                19.51,
                30.78,
                40.8,
                5.15,
                41.28,
            ],
            [
                72.55,
                72.82,
                43.32,
                83.94,
                32.05,
                2.56,
                74.41,
                93.3,
                80.92,
                45.45,
                54.13,
                88.34,
                34.25,
                43.43,
            ],
        ],
        [127.53],
    ],
    [
        [
            [18.21, 33.82, 42.46, 48.05, 49.44, 28.51, 20.44, 4.21, 43.53, 48.88, 15.23],
            [97.9, 7.44, 74.1, 40.44, 77.34, 53.34, 41.52, 8.94, 12.46, 87.0, 27.81],
        ],
        [167.05],
    ],
    [
        [
            [27.36, 25.59, 22.75, 26.21, 19.02, 43.86, 28.57, 43.93, 4.24, 33.09, 36.85],
            [6.31, 18.67, 67.65, 16.65, 99.24, 98.11, 5.45, 58.27, 13.95, 5.97, 94.16],
        ],
        [158.89],
    ],
    [
        [
            [35.28, 47.1, 20.98, 18.01, 40.86, 13.72, 31.64, 30.58, 2.6],
            [71.71, 28.91, 90.75, 21.33, 68.59, 48.19, 80.57, 95.74, 48.34],
        ],
        [88.31],
    ],
    [
        [
            [
                40.0,
                30.73,
                34.29,
                15.55,
                12.48,
                27.28,
                3.59,
                39.65,
                41.73,
                17.16,
                47.7,
                47.48,
                42.08,
            ],
            [
                49.61,
                92.72,
                19.71,
                81.73,
                53.59,
                24.41,
                77.05,
                48.7,
                91.22,
                14.78,
                41.9,
                76.84,
                74.41,
            ],
        ],
        [168.11],
    ],
    [[[12.46], [14.13]], [10.7]],
    [
        [
            [45.89, 42.84, 28.42, 14.59, 17.14, 42.26, 49.07, 22.48, 19.78, 6.45, 39.16],
            [80.9, 67.7, 55.72, 49.79, 76.05, 47.03, 58.26, 73.93, 75.63, 93.83, 23.53],
        ],
        [130.51],
    ],
    [[[14.76, 38.32, 30.15, 11.9, 8.31], [17.46, 1.29, 24.17, 83.99, 65.62]], [77.63]],
    [[[27.99, 9.45, 18.26, 39.86], [62.93, 89.68, 14.59, 2.33]], [65.88]],
    [[[28.56, 11.11, 32.83], [0.61, 65.18, 40.64]], [51.74]],
    [
        [
            [1.63, 36.3, 24.57, 27.15, 15.94, 48.14, 24.17, 6.69],
            [49.12, 24.96, 80.56, 17.19, 13.4, 50.95, 42.93, 27.4],
        ],
        [111.4],
    ],
    [
        [
            [
                27.26,
                34.84,
                11.23,
                15.75,
                34.67,
                25.62,
                47.41,
                28.39,
                49.97,
                42.4,
                36.07,
                38.5,
                47.97,
                40.25,
                35.47,
                15.41,
            ],
            [
                75.37,
                46.62,
                4.91,
                47.32,
                8.05,
                17.47,
                65.2,
                7.01,
                38.56,
                50.68,
                90.26,
                63.45,
                0.26,
                76.11,
                52.46,
                95.15,
            ],
        ],
        [284.48],
    ],
    [[[49.2], [91.16]], [4.35]],
    [[[10.08, 46.2, 37.74, 7.45], [23.23, 97.78, 50.63, 62.61]], [30.18]],
    [
        [
            [
                2.77,
                31.79,
                35.48,
                26.26,
                41.71,
                18.77,
                49.95,
                43.92,
                38.01,
                2.89,
                21.93,
                39.56,
                12.27,
                43.67,
                23.1,
                25.48,
            ],
            [
                91.34,
                15.1,
                48.54,
                24.69,
                19.84,
                83.63,
                22.09,
                20.97,
                97.64,
                98.39,
                7.54,
                39.38,
                49.67,
                4.03,
                19.56,
                58.43,
            ],
        ],
        [297.86],
    ],
    [
        [
            [
                34.4,
                18.7,
                3.88,
                4.68,
                48.93,
                36.49,
                14.18,
                36.03,
                32.7,
                14.6,
                45.7,
                36.77,
                24.15,
                31.61,
                8.14,
                4.34,
                41.43,
            ],
            [
                8.08,
                4.11,
                33.2,
                76.35,
                43.94,
                67.74,
                8.08,
                54.06,
                78.98,
                58.78,
                59.67,
                68.57,
                6.85,
                29.14,
                1.27,
                82.95,
                9.55,
            ],
        ],
        [256.06],
    ],
    [
        [
            [19.51, 30.11, 47.81, 44.75, 1.3, 47.96, 40.37, 45.92, 43.79, 21.96],
            [36.95, 0.95, 73.35, 90.33, 70.49, 68.75, 4.8, 40.74, 92.19, 39.32],
        ],
        [156.95],
    ],
    [
        [
            [
                43.95,
                24.64,
                28.08,
                31.88,
                39.48,
                22.39,
                49.78,
                31.97,
                3.97,
                5.68,
                24.34,
                22.47,
                23.6,
                28.09,
                34.28,
                43.72,
                39.21,
                49.56,
                38.9,
            ],
            [
                53.86,
                59.46,
                93.71,
                24.79,
                39.22,
                87.24,
                49.05,
                15.54,
                79.18,
                72.3,
                60.92,
                26.56,
                39.86,
                51.71,
                50.07,
                11.98,
                31.27,
                32.5,
                75.27,
            ],
        ],
        [317.02],
    ],
    [
        [
            [30.46, 17.84, 33.42, 18.95, 13.51, 47.43, 22.12],
            [62.66, 71.03, 65.26, 1.2, 82.71, 19.51, 18.17],
        ],
        [105.49],
    ],
    [
        [
            [20.87, 38.59, 45.91, 13.83, 2.83, 20.85, 7.74, 39.32, 21.46, 37.75],
            [67.02, 4.63, 39.28, 49.18, 81.12, 4.18, 49.89, 70.19, 38.52, 82.64],
        ],
        [134.45],
    ],
    [
        [
            [26.85, 11.68, 12.65, 24.32, 28.43, 42.73],
            [2.66, 5.85, 65.29, 69.26, 43.49, 89.98],
        ],
        [69.35],
    ],
    [
        [
            [
                18.25,
                34.33,
                35.44,
                25.93,
                7.75,
                48.38,
                22.92,
                15.82,
                26.53,
                22.86,
                31.08,
                43.67,
                44.91,
                25.97,
                43.31,
                22.33,
                23.99,
            ],
            [
                56.55,
                54.03,
                29.74,
                81.19,
                29.58,
                6.17,
                91.91,
                15.73,
                76.0,
                35.76,
                56.56,
                76.02,
                13.86,
                43.84,
                86.79,
                43.24,
                99.56,
            ],
        ],
        [236.32],
    ],
    [
        [
            [33.84, 42.34, 5.54, 0.3, 35.68, 38.33, 49.06],
            [88.36, 47.42, 91.7, 0.09, 41.32, 27.65, 18.81],
        ],
        [115.46],
    ],
    [[[49.02], [99.08]], [0.45]],
    [
        [
            [
                2.84,
                3.81,
                44.65,
                19.65,
                15.19,
                27.05,
                6.08,
                19.36,
                15.38,
                28.5,
                6.44,
                8.92,
                39.71,
                19.05,
            ],
            [
                76.12,
                68.24,
                33.39,
                37.54,
                2.65,
                83.42,
                44.31,
                97.82,
                5.59,
                46.55,
                26.51,
                64.97,
                93.91,
                78.36,
            ],
        ],
        [111.14],
    ],
    [[[22.06, 7.75], [16.38, 4.41]], [25.85]],
    [
        [
            [2.88, 3.47, 5.02, 49.66, 31.01, 22.76, 5.15, 41.0],
            [10.14, 78.16, 11.29, 33.0, 99.11, 3.48, 71.27, 33.98],
        ],
        [91.86],
    ],
    [
        [
            [14.66, 23.47, 37.98, 7.69, 14.93, 29.15, 25.84, 20.4, 17.96, 6.76, 27.31],
            [10.52, 65.62, 76.52, 20.0, 54.81, 91.09, 27.12, 4.12, 81.02, 83.92, 45.63],
        ],
        [103.34],
    ],
    [
        [
            [11.81, 5.67, 28.44, 21.88, 37.25, 29.93, 0.44, 15.39, 35.01, 6.18],
            [87.6, 13.0, 5.38, 91.3, 48.06, 3.53, 2.73, 92.19, 6.31, 88.68],
        ],
        [118.56],
    ],
    [
        [
            [
                16.03,
                41.61,
                21.58,
                14.18,
                6.28,
                48.88,
                38.87,
                1.93,
                49.36,
                23.09,
                43.26,
                14.29,
                44.03,
                41.48,
                2.32,
                11.54,
            ],
            [
                62.52,
                64.47,
                88.27,
                63.22,
                25.81,
                61.99,
                40.62,
                74.44,
                99.8,
                80.04,
                71.25,
                57.14,
                16.11,
                23.03,
                34.35,
                18.98,
            ],
        ],
        [178.36],
    ],
    [
        [
            [
                49.9,
                4.2,
                31.76,
                0.45,
                13.44,
                7.61,
                28.97,
                23.21,
                21.03,
                10.81,
                7.19,
                13.4,
                26.41,
                7.42,
                6.05,
                24.84,
                21.76,
                11.83,
            ],
            [
                41.74,
                56.34,
                68.58,
                91.48,
                40.74,
                99.31,
                18.04,
                38.13,
                60.32,
                57.85,
                21.61,
                39.54,
                41.82,
                63.09,
                69.95,
                8.8,
                83.32,
                10.61,
            ],
        ],
        [170.46],
    ],
    [
        [
            [
                16.37,
                48.94,
                45.55,
                1.14,
                2.79,
                42.48,
                22.46,
                11.5,
                25.11,
                1.19,
                2.91,
                30.34,
                19.19,
                1.08,
                10.31,
                37.25,
            ],
            [
                63.19,
                81.05,
                54.26,
                69.55,
                90.8,
                94.89,
                19.43,
                8.63,
                13.8,
                19.65,
                90.85,
                83.76,
                61.29,
                80.92,
                3.3,
                92.66,
            ],
        ],
        [115.65],
    ],
    [[[9.0, 41.54, 26.92, 42.41], [81.46, 11.25, 59.03, 24.92]], [81.41]],
    [
        [
            [
                19.25,
                21.65,
                5.97,
                31.28,
                19.61,
                40.21,
                18.8,
                29.78,
                13.95,
                12.37,
                5.37,
                12.45,
                12.78,
                2.01,
                36.8,
                24.0,
                17.43,
                48.31,
            ],
            [
                57.43,
                74.13,
                16.72,
                25.94,
                15.61,
                53.68,
                51.22,
                19.09,
                95.78,
                69.02,
                7.26,
                1.19,
                90.31,
                99.62,
                1.0,
                81.4,
                23.96,
                96.54,
            ],
        ],
        [189.14],
    ],
    [
        [
            [
                5.21,
                30.13,
                15.82,
                12.5,
                37.26,
                0.98,
                44.71,
                47.92,
                5.97,
                3.24,
                33.8,
                17.5,
                44.94,
                13.51,
                5.23,
                15.46,
                33.54,
            ],
            [
                75.07,
                51.49,
                30.5,
                69.06,
                28.36,
                31.82,
                46.77,
                41.69,
                99.03,
                21.41,
                26.42,
                6.91,
                81.66,
                57.44,
                43.25,
                63.71,
                11.76,
            ],
        ],
        [205.81],
    ],
    [
        [
            [
                21.97,
                47.92,
                27.13,
                31.76,
                40.47,
                34.53,
                46.89,
                29.36,
                40.39,
                43.67,
                46.88,
                22.16,
                5.49,
            ],
            [
                82.66,
                95.53,
                28.87,
                56.99,
                40.62,
                52.05,
                14.94,
                25.27,
                47.5,
                94.46,
                46.25,
                15.83,
                2.82,
            ],
        ],
        [214.13],
    ],
    [
        [
            [
                45.66,
                28.97,
                26.02,
                5.69,
                1.59,
                27.43,
                25.86,
                23.15,
                37.1,
                0.29,
                12.27,
                48.53,
                4.17,
            ],
            [
                5.55,
                68.03,
                81.49,
                28.12,
                46.89,
                36.25,
                80.66,
                67.25,
                32.17,
                59.55,
                11.13,
                40.98,
                15.21,
            ],
        ],
        [160.57],
    ],
]

function shopping_algo(x, y)
    # mult
    # discounts = x[2] .* 0.01
    discounts = div_broadcast(x[2], 100)
    # substract 
    discounts = subtract_broadcast(discounts, 1)
    # abs v 
    discounts = abs_vector(discounts)
    # mult 
    res = mult_vector(x[1], discounts)
    # sum 
    res = reduce_sum(res)
    isapprox(res, y[1], atol = 1e-2)
    # round(res, digits = 2) == y[1]
end

@testset "Shopping list" begin
    for (x, y) in train_data
        @test begin
            shopping_algo(x, y)
        end
    end
end
